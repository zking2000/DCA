âœ… æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼šA. Yes

â¸»

ğŸ’¡ ä¸€ã€é¢˜ç›®å›é¡¾

Question:
A companyâ€™s security policy specifies that development and production containers must run on separate nodes in a given Swarm cluster.

Solution:
node affinities

Answer: âœ… A. Yes

â¸»

ğŸ§± äºŒã€è€ƒç‚¹ï¼šSwarm ä¸­çš„â€œè°ƒåº¦çº¦æŸï¼ˆScheduling Constraintsï¼‰â€

åœ¨ Docker Swarm æ¨¡å¼ä¸‹ï¼ŒæœåŠ¡éƒ¨ç½²æ—¶å¯ä»¥é€šè¿‡ node affinityï¼ˆèŠ‚ç‚¹äº²å’Œæ€§ï¼‰ æˆ– constraintsï¼ˆçº¦æŸæ¡ä»¶ï¼‰
æ¥æ§åˆ¶å®¹å™¨åœ¨å“ªäº›èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚

è¿™æ­£æ˜¯å®ç°é¢˜ç›®ä¸­â€œè®©å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒåˆ†å¼€è¿è¡Œâ€çš„æœºåˆ¶ã€‚

â¸»

âš™ï¸ ä¸‰ã€node affinityï¼ˆèŠ‚ç‚¹äº²å’Œæ€§ï¼‰çš„åŸç†

Docker Swarm ä½¿ç”¨ èŠ‚ç‚¹æ ‡ç­¾ï¼ˆnode labelsï¼‰ æ¥å®šä¹‰èŠ‚ç‚¹çš„ç‰¹æ€§ï¼Œ
ç„¶ååœ¨æœåŠ¡éƒ¨ç½²æ—¶ä½¿ç”¨ --constraint å‚æ•°æŒ‡å®šè°ƒåº¦è§„åˆ™ã€‚

ä¾‹å¦‚ï¼š

docker node update --label-add env=prod node-1
docker node update --label-add env=dev node-2

ç„¶ååœ¨éƒ¨ç½²æœåŠ¡æ—¶ï¼š

âœ… éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒå®¹å™¨ï¼š

docker service create \
  --name web-prod \
  --constraint 'node.labels.env == prod' \
  nginx

âœ… éƒ¨ç½²å¼€å‘ç¯å¢ƒå®¹å™¨ï¼š

docker service create \
  --name web-dev \
  --constraint 'node.labels.env == dev' \
  nginx

ç»“æœï¼š
	â€¢	æ‰€æœ‰ç”Ÿäº§å®¹å™¨åªä¼šè°ƒåº¦åˆ°å¸¦æœ‰ env=prod æ ‡ç­¾çš„èŠ‚ç‚¹ï¼›
	â€¢	æ‰€æœ‰å¼€å‘å®¹å™¨åªä¼šè°ƒåº¦åˆ°å¸¦æœ‰ env=dev æ ‡ç­¾çš„èŠ‚ç‚¹ï¼›
	â€¢	æ»¡è¶³å®‰å…¨ç­–ç•¥ï¼šä¸åŒç¯å¢ƒçš„å®¹å™¨è¿è¡Œåœ¨ä¸åŒèŠ‚ç‚¹ä¸Šã€‚

â¸»

ğŸ§© å››ã€å¯¹æ¯”å…¶ä»– Swarm è°ƒåº¦æœºåˆ¶

è°ƒåº¦æœºåˆ¶	åŠŸèƒ½	æ˜¯å¦æ»¡è¶³é¢˜æ„
node affinity / constraint	æŒ‰æ ‡ç­¾æ§åˆ¶å®¹å™¨åœ¨å“ªäº›èŠ‚ç‚¹è¿è¡Œ	âœ… æ˜¯
placement preferences	ä¼˜åŒ–èŠ‚ç‚¹è´Ÿè½½åˆ†å¸ƒï¼ˆä¾‹å¦‚å‡è¡¡ï¼‰	âŒ å¦
node taints & tolerations	æ§åˆ¶å“ªäº›æœåŠ¡èƒ½å®¹å¿ç‰¹æ®ŠèŠ‚ç‚¹	âœ… å¯ç”¨äºé«˜çº§éš”ç¦»
resource limits	æ§åˆ¶èµ„æºä½¿ç”¨	âŒ å¦ï¼ˆä¸å½±å“èŠ‚ç‚¹åˆ†é…ï¼‰


â¸»

ğŸ§  äº”ã€è¡¥å……ï¼šSwarm â€œaffinityâ€ ä¸ â€œconstraintâ€ çš„åŒºåˆ«

åç§°	å«ä¹‰	ä½¿ç”¨åœºæ™¯
node affinity / constraint	åŸºäºèŠ‚ç‚¹æ ‡ç­¾è¿›è¡Œè°ƒåº¦ï¼ˆå¼ºçº¦æŸï¼‰	æŒ‡å®šæœåŠ¡å¿…é¡»åœ¨å“ªäº›èŠ‚ç‚¹ä¸Šè¿è¡Œ
service affinity	åŸºäºå·²æœ‰å®¹å™¨æˆ–æœåŠ¡è¿›è¡Œè°ƒåº¦ï¼ˆè½¯çº¦æŸï¼‰	è®©æœåŠ¡åœ¨ç›¸åŒ/ä¸åŒèŠ‚ç‚¹ä¸Šè¿è¡Œï¼ˆå¦‚ service==redisï¼‰

åœ¨æœ¬é¢˜ä¸­ï¼Œå› ä¸ºè¦åŒºåˆ† dev ä¸ prod èŠ‚ç‚¹ â†’ ç”¨ node affinityã€‚

â¸»

âœ… å…­ã€æ€»ç»“

ç›®æ ‡	å®ç°æ–¹å¼
å¼€å‘ä¸ç”Ÿäº§å®¹å™¨å¿…é¡»åˆ†å¼€è¿è¡Œ	âœ… ç»™èŠ‚ç‚¹æ‰“æ ‡ç­¾ï¼ˆnode.labels.env=prod/devï¼‰
æ§åˆ¶è°ƒåº¦ç­–ç•¥	âœ… ä½¿ç”¨ --constraint æˆ– node affinity
ä¿éšœå®‰å…¨ç­–ç•¥	âœ… Swarm åŸç”Ÿæ”¯æŒ


â¸»

âœ… æœ€ç»ˆç­”æ¡ˆï¼šA. Yes

å› ä¸º node affinitiesï¼ˆèŠ‚ç‚¹äº²å’Œæ€§ï¼‰å¯ç”¨äºæ ¹æ®èŠ‚ç‚¹æ ‡ç­¾è°ƒåº¦å®¹å™¨ï¼Œ
ä»è€Œä¿è¯å¼€å‘ä¸ç”Ÿäº§ç¯å¢ƒè¿è¡Œåœ¨ä¸åŒèŠ‚ç‚¹ä¸Šï¼Œç¬¦åˆå®‰å…¨éš”ç¦»è¦æ±‚ã€‚