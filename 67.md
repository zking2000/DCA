✅ 正确答案：C. UCP audit logs must be set to the ‘metadata’ or ‘request’ level.

⸻

💡 一、题目回顾

Question:
When an application being managed by UCP fails, you would like a summary of all requests made to the UCP API in the hours leading up to the failure.

What must be configured correctly beforehand for this to be possible?

Options:
A. All engines in the cluster must have their log driver set to the ‘metadata’ or ‘request’ level.
B. UCP logging levels must be set to the ‘info’ or ‘debug’ level.
C. UCP audit logs must be set to the ‘metadata’ or ‘request’ level.
D. Set the logging level in the config object for the ucp-kube-apiserver container to ‘warning’ or higher.

✅ Answer: C

⸻

🧱 二、考点：Docker Enterprise UCP（Universal Control Plane）的审计日志机制

UCP（Docker Universal Control Plane）提供 Audit Logs（审计日志） 功能，
可以记录所有通过 UCP API、CLI、Web UI 进行的请求操作。

题目问的是：

“希望在应用失败前，能回溯所有对 UCP API 的请求”

—— 这正是 UCP Audit Logs 的功能。

⸻

⚙️ 三、UCP Audit Logs 级别详解

UCP 的审计日志支持三个级别（level）：

级别	含义	适用场景
none	不记录任何请求	默认最节省性能
metadata	记录请求的元数据（用户、时间、API endpoint）	常用，性能与审计平衡
request	记录请求的完整内容（含 payload）	最详细，便于排查问题


⸻

✅ 举例：

配置 UCP 审计日志为 metadata 或 request：

docker run --rm -it \
  --log-level info \
  docker/ucp:3.3.6 \
  manage-audit --set-level request

之后可以在 UCP 的日志路径中看到：

/var/lib/docker/ucp/audit.log

日志条目示例：

{
  "user": "admin",
  "request": "POST /api/ucp/cluster/services",
  "timestamp": "2025-10-06T13:45:21Z",
  "status": "201 Created"
}


⸻

🧩 四、选项逐项分析

选项	是否正确	原因
A. All engines in the cluster must have their log driver set to ‘metadata’ or ‘request’	❌ 否	log-driver 属于 Docker Engine 层，与 UCP API 日志无关
B. UCP logging levels must be set to ‘info’ or ‘debug’	❌ 否	info/debug 是运行日志级别，不包含 API 审计请求内容
✅ C. UCP audit logs must be set to ‘metadata’ or ‘request’ level	✅ 正确	audit logs 才能记录 API 调用轨迹
D. Set the logging level for ucp-kube-apiserver to ‘warning’ or higher	❌ 否	这是 Kubernetes 层日志，与 UCP API 审计机制无关


⸻

🧠 五、总结

若希望在应用失败时查看 UCP 接收到的所有 API 请求历史，
必须提前启用 UCP Audit Logs，并设置为 metadata 或 request 级别。

⸻

✅ 最终答案：C. UCP audit logs must be set to the ‘metadata’ or ‘request’ level.

因为只有 UCP 审计日志（Audit Logs）会记录所有 API 调用及请求信息，用于事后追踪和问题定位。