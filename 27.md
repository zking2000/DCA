✅ 正确答案是：C 和 E

⸻

💡 一、题目回顾

你在从 Docker Trusted Registry (DTR) 拉取镜像时，
出现错误：

x509: certificate signed by unknown authority

你已经从 https://dtr.example.com/ca 下载了自签名证书。

问：如何让 Docker 信任该证书？（选择两项）

⸻

🧱 二、错误原因

这个错误说明：

Docker 客户端无法验证 DTR 使用的自签名 TLS 证书的信任链。

Docker 默认只信任：
	•	系统的受信任 CA（如 Let’s Encrypt、DigiCert 等）；
	•	以及 /etc/docker/certs.d/ 目录中配置的自定义信任证书。

因此，你必须显式添加 DTR 的 CA 证书。

⸻

✅ 三、正确做法（两种方式）

✅ 选项 C：放入 /etc/docker/certs.d/<registry>/ca.crt

路径规范：

/etc/docker/certs.d/<registry_host>/ca.crt

例如：

sudo mkdir -p /etc/docker/certs.d/dtr.example.com
sudo cp ca.crt /etc/docker/certs.d/dtr.example.com/ca.crt
sudo systemctl restart docker

✅ Docker 会自动信任此证书，仅对该 registry (dtr.example.com) 有效。

✅ 这是 Docker 官方推荐 的 DTR 信任配置方式。

⸻

✅ 选项 E：导入到操作系统信任存储（系统级）

将证书导入系统信任链，例如：

在 Ubuntu / Debian：

sudo cp ca.crt /usr/local/share/ca-certificates/dtr.example.com.crt
sudo update-ca-certificates
sudo systemctl restart docker

在 RHEL / CentOS：

sudo cp ca.crt /etc/pki/ca-trust/source/anchors/dtr.example.com.crt
sudo update-ca-trust
sudo systemctl restart docker

✅ 这样证书对所有进程（包括 Docker）都有效。

✅ 适用于需要系统范围内信任自签名 CA 的情况。

⸻

❌ 四、错误选项解析

选项	是否正确	原因
A. Pass ‘-trust-certificate ca.crt’	❌	Docker CLI 没有此参数
B. /etc/docker/dtr/...	❌	该路径不是 Docker 信任证书目录，Docker 不会读取此位置
D. --insecure-registry	⚠️ 临时可行但不安全	会禁用 TLS 验证，不推荐用于生产环境


⸻

✅ 五、总结

选项	说明
✅ C	把证书放入 /etc/docker/certs.d/dtr.example.com/ca.crt
✅ E	导入系统 CA 存储，系统级信任
❌ A, B, D	非标准或不安全方式


⸻

✅ 最终答案：C 和 E

	•	C： 为指定 DTR 注册表添加专用信任证书；
	•	E： 在操作系统层面导入证书，实现系统级信任。