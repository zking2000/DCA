âœ… æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼šC å’Œ E

â¸»

ğŸ’¡ ä¸€ã€é¢˜ç›®å›é¡¾

ä½ åœ¨ä» Docker Trusted Registry (DTR) æ‹‰å–é•œåƒæ—¶ï¼Œ
å‡ºç°é”™è¯¯ï¼š

x509: certificate signed by unknown authority

ä½ å·²ç»ä» https://dtr.example.com/ca ä¸‹è½½äº†è‡ªç­¾åè¯ä¹¦ã€‚

é—®ï¼šå¦‚ä½•è®© Docker ä¿¡ä»»è¯¥è¯ä¹¦ï¼Ÿï¼ˆé€‰æ‹©ä¸¤é¡¹ï¼‰

â¸»

ğŸ§± äºŒã€é”™è¯¯åŸå› 

è¿™ä¸ªé”™è¯¯è¯´æ˜ï¼š

Docker å®¢æˆ·ç«¯æ— æ³•éªŒè¯ DTR ä½¿ç”¨çš„è‡ªç­¾å TLS è¯ä¹¦çš„ä¿¡ä»»é“¾ã€‚

Docker é»˜è®¤åªä¿¡ä»»ï¼š
	â€¢	ç³»ç»Ÿçš„å—ä¿¡ä»» CAï¼ˆå¦‚ Letâ€™s Encryptã€DigiCert ç­‰ï¼‰ï¼›
	â€¢	ä»¥åŠ /etc/docker/certs.d/ ç›®å½•ä¸­é…ç½®çš„è‡ªå®šä¹‰ä¿¡ä»»è¯ä¹¦ã€‚

å› æ­¤ï¼Œä½ å¿…é¡»æ˜¾å¼æ·»åŠ  DTR çš„ CA è¯ä¹¦ã€‚

â¸»

âœ… ä¸‰ã€æ­£ç¡®åšæ³•ï¼ˆä¸¤ç§æ–¹å¼ï¼‰

âœ… é€‰é¡¹ Cï¼šæ”¾å…¥ /etc/docker/certs.d/<registry>/ca.crt

è·¯å¾„è§„èŒƒï¼š

/etc/docker/certs.d/<registry_host>/ca.crt

ä¾‹å¦‚ï¼š

sudo mkdir -p /etc/docker/certs.d/dtr.example.com
sudo cp ca.crt /etc/docker/certs.d/dtr.example.com/ca.crt
sudo systemctl restart docker

âœ… Docker ä¼šè‡ªåŠ¨ä¿¡ä»»æ­¤è¯ä¹¦ï¼Œä»…å¯¹è¯¥ registry (dtr.example.com) æœ‰æ•ˆã€‚

âœ… è¿™æ˜¯ Docker å®˜æ–¹æ¨è çš„ DTR ä¿¡ä»»é…ç½®æ–¹å¼ã€‚

â¸»

âœ… é€‰é¡¹ Eï¼šå¯¼å…¥åˆ°æ“ä½œç³»ç»Ÿä¿¡ä»»å­˜å‚¨ï¼ˆç³»ç»Ÿçº§ï¼‰

å°†è¯ä¹¦å¯¼å…¥ç³»ç»Ÿä¿¡ä»»é“¾ï¼Œä¾‹å¦‚ï¼š

åœ¨ Ubuntu / Debianï¼š

sudo cp ca.crt /usr/local/share/ca-certificates/dtr.example.com.crt
sudo update-ca-certificates
sudo systemctl restart docker

åœ¨ RHEL / CentOSï¼š

sudo cp ca.crt /etc/pki/ca-trust/source/anchors/dtr.example.com.crt
sudo update-ca-trust
sudo systemctl restart docker

âœ… è¿™æ ·è¯ä¹¦å¯¹æ‰€æœ‰è¿›ç¨‹ï¼ˆåŒ…æ‹¬ Dockerï¼‰éƒ½æœ‰æ•ˆã€‚

âœ… é€‚ç”¨äºéœ€è¦ç³»ç»ŸèŒƒå›´å†…ä¿¡ä»»è‡ªç­¾å CA çš„æƒ…å†µã€‚

â¸»

âŒ å››ã€é”™è¯¯é€‰é¡¹è§£æ

é€‰é¡¹	æ˜¯å¦æ­£ç¡®	åŸå› 
A. Pass â€˜-trust-certificate ca.crtâ€™	âŒ	Docker CLI æ²¡æœ‰æ­¤å‚æ•°
B. /etc/docker/dtr/...	âŒ	è¯¥è·¯å¾„ä¸æ˜¯ Docker ä¿¡ä»»è¯ä¹¦ç›®å½•ï¼ŒDocker ä¸ä¼šè¯»å–æ­¤ä½ç½®
D. --insecure-registry	âš ï¸ ä¸´æ—¶å¯è¡Œä½†ä¸å®‰å…¨	ä¼šç¦ç”¨ TLS éªŒè¯ï¼Œä¸æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒ


â¸»

âœ… äº”ã€æ€»ç»“

é€‰é¡¹	è¯´æ˜
âœ… C	æŠŠè¯ä¹¦æ”¾å…¥ /etc/docker/certs.d/dtr.example.com/ca.crt
âœ… E	å¯¼å…¥ç³»ç»Ÿ CA å­˜å‚¨ï¼Œç³»ç»Ÿçº§ä¿¡ä»»
âŒ A, B, D	éæ ‡å‡†æˆ–ä¸å®‰å…¨æ–¹å¼


â¸»

âœ… æœ€ç»ˆç­”æ¡ˆï¼šC å’Œ E

	â€¢	Cï¼š ä¸ºæŒ‡å®š DTR æ³¨å†Œè¡¨æ·»åŠ ä¸“ç”¨ä¿¡ä»»è¯ä¹¦ï¼›
	â€¢	Eï¼š åœ¨æ“ä½œç³»ç»Ÿå±‚é¢å¯¼å…¥è¯ä¹¦ï¼Œå®ç°ç³»ç»Ÿçº§ä¿¡ä»»ã€‚