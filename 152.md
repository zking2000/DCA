✅ 正确答案：B. No

⸻

💡 一、题目回顾

Question:
Seven managers are in a Swarm cluster.
Is this how they should be distributed across three datacenters or availability zones?

Solution: 4-2-1

Answer: B. No

⸻

🧱 二、考点：Docker Swarm 的 Raft 共识机制（Raft Consensus Algorithm）

Docker Swarm 使用 Raft 算法来维持 manager 节点间的一致性。
Raft 的基本规则是：

集群中必须保持 多数派 (Quorum) 可用，才能继续选举 leader 并正常运行。

也就是说：
	•	有 7 个 manager 时，至少要有 4 个 在线；
	•	一旦少于 4 个 manager 存活，整个集群的控制平面就会瘫痪（无法调度）。

⸻

⚙️ 三、错误方案分析：4-2-1

数据中心	Manager 数量	问题
DC1	4	集中风险太高
DC2	2	次要可用区
DC3	1	备用区

看似“分布在三个可用区”，但问题是：
	•	如果 DC1 宕机（最常见的灾难场景之一），
只剩下 2 + 1 = 3 个 manager。
	•	3 < 4 → 无法达到多数派（quorum）。
	•	结果：整个 Swarm 集群无法选举 leader，管理平面停摆。

➡️ 高可用性失效！

⸻

🧩 四、正确分布方案：3-2-2（或 2-3-2）

目标是：

任意一个数据中心宕机后，仍保留至少 4 个 manager。

数据中心	Manager 数量	效果
DC1	3	主节点区
DC2	2	次节点区
DC3	2	冗余节点区

验证：
	•	若 DC1 宕机 → 2 + 2 = 4 → ✅ 仍可维持多数派
	•	若 DC2 宕机 → 3 + 2 = 5 → ✅
	•	若 DC3 宕机 → 3 + 2 = 5 → ✅

💪 任何单一可用区失效都不会影响集群选举与运行。

⸻

🧠 五、设计原则总结

Docker 官方推荐的分布策略：

Manager 数量	推荐分布
3 个	1-1-1（跨三个 AZ）
5 个	2-2-1（或 3-1-1）
7 个	3-2-2（或 2-3-2）

⚠️ 不要在单一区域放置超过半数的 manager。
否则单区故障会导致整个集群不可用。

⸻

✅ 六、最终结论

“4-2-1” 的分布方式无法保证在单个数据中心失效时仍维持多数派，因此 不推荐。

正确做法应为 3-2-2 或等价的均衡分布。

⸻

✅ 最终答案：B. No

因为 “4-2-1” 的分布在一个数据中心宕机时会失去多数派，
无法保证 Swarm 管理平面的高可用性。