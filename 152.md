âœ… æ­£ç¡®ç­”æ¡ˆï¼šB. No

â¸»

ğŸ’¡ ä¸€ã€é¢˜ç›®å›é¡¾

Question:
Seven managers are in a Swarm cluster.
Is this how they should be distributed across three datacenters or availability zones?

Solution: 4-2-1

Answer: B. No

â¸»

ğŸ§± äºŒã€è€ƒç‚¹ï¼šDocker Swarm çš„ Raft å…±è¯†æœºåˆ¶ï¼ˆRaft Consensus Algorithmï¼‰

Docker Swarm ä½¿ç”¨ Raft ç®—æ³•æ¥ç»´æŒ manager èŠ‚ç‚¹é—´çš„ä¸€è‡´æ€§ã€‚
Raft çš„åŸºæœ¬è§„åˆ™æ˜¯ï¼š

é›†ç¾¤ä¸­å¿…é¡»ä¿æŒ å¤šæ•°æ´¾ (Quorum) å¯ç”¨ï¼Œæ‰èƒ½ç»§ç»­é€‰ä¸¾ leader å¹¶æ­£å¸¸è¿è¡Œã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼š
	â€¢	æœ‰ 7 ä¸ª manager æ—¶ï¼Œè‡³å°‘è¦æœ‰ 4 ä¸ª åœ¨çº¿ï¼›
	â€¢	ä¸€æ—¦å°‘äº 4 ä¸ª manager å­˜æ´»ï¼Œæ•´ä¸ªé›†ç¾¤çš„æ§åˆ¶å¹³é¢å°±ä¼šç˜«ç—ªï¼ˆæ— æ³•è°ƒåº¦ï¼‰ã€‚

â¸»

âš™ï¸ ä¸‰ã€é”™è¯¯æ–¹æ¡ˆåˆ†æï¼š4-2-1

æ•°æ®ä¸­å¿ƒ	Manager æ•°é‡	é—®é¢˜
DC1	4	é›†ä¸­é£é™©å¤ªé«˜
DC2	2	æ¬¡è¦å¯ç”¨åŒº
DC3	1	å¤‡ç”¨åŒº

çœ‹ä¼¼â€œåˆ†å¸ƒåœ¨ä¸‰ä¸ªå¯ç”¨åŒºâ€ï¼Œä½†é—®é¢˜æ˜¯ï¼š
	â€¢	å¦‚æœ DC1 å®•æœºï¼ˆæœ€å¸¸è§çš„ç¾éš¾åœºæ™¯ä¹‹ä¸€ï¼‰ï¼Œ
åªå‰©ä¸‹ 2 + 1 = 3 ä¸ª managerã€‚
	â€¢	3 < 4 â†’ æ— æ³•è¾¾åˆ°å¤šæ•°æ´¾ï¼ˆquorumï¼‰ã€‚
	â€¢	ç»“æœï¼šæ•´ä¸ª Swarm é›†ç¾¤æ— æ³•é€‰ä¸¾ leaderï¼Œç®¡ç†å¹³é¢åœæ‘†ã€‚

â¡ï¸ é«˜å¯ç”¨æ€§å¤±æ•ˆï¼

â¸»

ğŸ§© å››ã€æ­£ç¡®åˆ†å¸ƒæ–¹æ¡ˆï¼š3-2-2ï¼ˆæˆ– 2-3-2ï¼‰

ç›®æ ‡æ˜¯ï¼š

ä»»æ„ä¸€ä¸ªæ•°æ®ä¸­å¿ƒå®•æœºåï¼Œä»ä¿ç•™è‡³å°‘ 4 ä¸ª managerã€‚

æ•°æ®ä¸­å¿ƒ	Manager æ•°é‡	æ•ˆæœ
DC1	3	ä¸»èŠ‚ç‚¹åŒº
DC2	2	æ¬¡èŠ‚ç‚¹åŒº
DC3	2	å†—ä½™èŠ‚ç‚¹åŒº

éªŒè¯ï¼š
	â€¢	è‹¥ DC1 å®•æœº â†’ 2 + 2 = 4 â†’ âœ… ä»å¯ç»´æŒå¤šæ•°æ´¾
	â€¢	è‹¥ DC2 å®•æœº â†’ 3 + 2 = 5 â†’ âœ…
	â€¢	è‹¥ DC3 å®•æœº â†’ 3 + 2 = 5 â†’ âœ…

ğŸ’ª ä»»ä½•å•ä¸€å¯ç”¨åŒºå¤±æ•ˆéƒ½ä¸ä¼šå½±å“é›†ç¾¤é€‰ä¸¾ä¸è¿è¡Œã€‚

â¸»

ğŸ§  äº”ã€è®¾è®¡åŸåˆ™æ€»ç»“

Docker å®˜æ–¹æ¨èçš„åˆ†å¸ƒç­–ç•¥ï¼š

Manager æ•°é‡	æ¨èåˆ†å¸ƒ
3 ä¸ª	1-1-1ï¼ˆè·¨ä¸‰ä¸ª AZï¼‰
5 ä¸ª	2-2-1ï¼ˆæˆ– 3-1-1ï¼‰
7 ä¸ª	3-2-2ï¼ˆæˆ– 2-3-2ï¼‰

âš ï¸ ä¸è¦åœ¨å•ä¸€åŒºåŸŸæ”¾ç½®è¶…è¿‡åŠæ•°çš„ managerã€‚
å¦åˆ™å•åŒºæ•…éšœä¼šå¯¼è‡´æ•´ä¸ªé›†ç¾¤ä¸å¯ç”¨ã€‚

â¸»

âœ… å…­ã€æœ€ç»ˆç»“è®º

â€œ4-2-1â€ çš„åˆ†å¸ƒæ–¹å¼æ— æ³•ä¿è¯åœ¨å•ä¸ªæ•°æ®ä¸­å¿ƒå¤±æ•ˆæ—¶ä»ç»´æŒå¤šæ•°æ´¾ï¼Œå› æ­¤ ä¸æ¨èã€‚

æ­£ç¡®åšæ³•åº”ä¸º 3-2-2 æˆ–ç­‰ä»·çš„å‡è¡¡åˆ†å¸ƒã€‚

â¸»

âœ… æœ€ç»ˆç­”æ¡ˆï¼šB. No

å› ä¸º â€œ4-2-1â€ çš„åˆ†å¸ƒåœ¨ä¸€ä¸ªæ•°æ®ä¸­å¿ƒå®•æœºæ—¶ä¼šå¤±å»å¤šæ•°æ´¾ï¼Œ
æ— æ³•ä¿è¯ Swarm ç®¡ç†å¹³é¢çš„é«˜å¯ç”¨æ€§ã€‚